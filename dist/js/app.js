"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}var Table=function(){function c(){var r=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"app";_classCallCheck(this,c),"string"!=typeof t?(this.el="app",console.log("the app will build in #app div")):this.el=t,this.wrapper=document.getElementById(this.el),this.controler={incrementLastChoiceId:function(){return r.data.lastChoiceId++},incrementLastFactorId:function(){return r.data.lastFactorId++},countFactors:function(){return r.data.factors.filter(function(t){return!0===t.visible}).length},countChoices:function(){return r.data.choices.filter(function(t){return!0===t.visible}).length},addFactor:function(){r.controler.incrementLastFactorId(),r.data.setFactor({id:r.data.lastFactorId,content:"Factor ".concat(r.data.lastFactorId),rate:0,visible:!0,factorsRate:[]}),r.data.choices.filter(function(t){return!0===t.visible}).forEach(function(t){r.data.setFactorRate(r.data.lastFactorId,t.id,0)}),r.vue.insertNewRow()},addChoice:function(){r.controler.incrementLastChoiceId(),r.data.setChoice({id:r.data.lastChoiceId,content:"Choix ".concat(r.data.lastChoiceId),score:0,visible:!0}),r.data.factors.filter(function(t){return!0===t.visible}).forEach(function(t){return r.data.setFactorRate(t.id,r.data.lastChoiceId,0)}),r.vue.insertNewColumn()},deleteFactor:function(t){r.data.setFactorInvisible(t.dataset.factorid),r.vue.deleteRow(t)},deleteChoice:function(t){r.data.setChoiceInvisible(t.dataset.choiceid),r.vue.deleteColumn(t.dataset.choiceid)},updateFactorContent:function(t){r.data.factors[t.target.parentNode.dataset.factorid].content=t.target.innerHTML.trim()},updateChoiceContent:function(t){r.data.choices[t.target.parentNode.dataset.choiceid].content=t.target.innerHTML.trim()},updateScore:function(e){r.data.setRate(e.target.dataset.factorid,e.target.dataset.choiceid,r.vue.incrementRate(e)),r.data.setScore(),r.data.choices.forEach(function(t){t.id==e.target.dataset.choiceid&&r.vue.updateScore(e.target.dataset.choiceid,t.score)})},updateBestChoice:function(){var t=r.data.getBestChoice().map(function(t){return t.content}).join(" / ");r.vue.renderBestChoice(t)},initRender:function(t){t.innerHTML=r.vue.getInitTemplate()},listenClickEvents:function(){r.wrapper.addEventListener("click",function(t){t.target.hasAttribute("data-choiceid")&&t.target.hasAttribute("data-factorid")?(r.controler.updateScore(t),r.controler.updateBestChoice()):t.target===document.getElementById("addChoice-btn")?r.controler.addChoice():t.target===document.getElementById("addFactor-btn")?r.controler.addFactor():t.target.classList.contains("factor-btn__del")?r.controler.deleteFactor(t.target.parentNode):t.target.classList.contains("choice-btn__del")?r.controler.deleteChoice(t.target.parentNode):(t.target.classList.contains("factor-content")||t.target.classList.contains("choice-content"))&&t.target.addEventListener("input",function(){t.target.parentNode.dataset.factorid?(r.controler.updateFactorContent(t),r.controler.updateBestChoice()):t.target.parentNode.dataset.choiceid&&(r.controler.updateChoiceContent(t),r.controler.updateBestChoice())})},!0)}},this.data={choicesCount:0,factorsCount:0,lastChoiceId:0,lastFactorId:0,choices:[{id:0,content:"Choix 0",score:0,visible:!0}],factors:[{id:0,content:"Factor 0",rate:0,visible:!0,factorsRate:[{choiceId:0,rate:0}]}],getChoice:function(e){return r.data.choices.find(function(t){return t.id==e})},getAllChoices:function(){return r.data.choices},getFactor:function(e){return r.data.factors.find(function(t){return t.id==e})},getAllFactors:function(){return r.data.factors},getFactorRate:function(c,a){var n;return r.data.factors.forEach(function(e){e.factorsRate.forEach(function(t){e.id==c&&t.choiceId==a&&(n=t)})}),n},getBestChoice:function(){var e=r.data.choices.filter(function(t){return!0===t.visible}).reduce(function(t,e,c,a){return t.score>e.score?t:e});return r.data.choices.filter(function(t){return t.score===e.score})},setChoice:function(t){r.data.choices.push(t)},setFactor:function(t){r.data.factors.push(t)},setFactorRate:function(e,c,a){r.data.factors.forEach(function(t){t.id==e&&t.factorsRate.push({choiceId:c,rate:a})})},setRate:function(e,c,a){r.data.factors.forEach(function(t){t.id==e&&t.factorsRate.forEach(function(t){t.choiceId==c&&(t.rate=a)})})},setFactorVisible:function(e){r.data.factors.forEach(function(t){t.id==e&&0==t.visible&&(t.visible=!0)})},setFactorInvisible:function(e){r.data.factors.forEach(function(t){t.id==e&&1==t.visible&&(t.visible=!1)})},setChoiceVisible:function(e){r.data.choices.forEach(function(t){t.id==e&&0==t.visible&&(t.visible=!0)})},setChoiceInvisible:function(e){r.data.choices.forEach(function(t){t.id==e&&1==t.visible&&(t.visible=!1)})},setScore:function(){r.data.choices.forEach(function(e){var c=0;r.data.factors.forEach(function(t){t.factorsRate.forEach(function(t){t.choiceId===e.id&&(c+=t.rate)})}),e.score=c})}},this.vue={getInitTemplate:function(){return'\n    <table class="table table-responsive">\n      <tbody>\n        <tr>\n          <td></td>\n          <td class="score" data-choiceid="'.concat(r.data.choices[0].id,'">\n            <div class="score__content">').concat(r.data.choices[0].score,'</div>\n\n          </td>\n          <td id="lastscorecol" class="add-col"></td>\n        </tr>\n        <tr>\n          <td></td>\n          <td data-choiceid="').concat(r.data.choices[0].id,'"  class="choice cell">\n            <div\n              class="choice-content text-center"\n              contenteditable="true"\n            >').concat(r.data.choices[0].content,'\n            </div>\n            <span class="choice-btn__del btn-del">Enlever</span>\n          </td>\n          <td class="addCell-choice add-col cell">\n            <div id="addChoice-btn">\n              Ajouter\n            </div>\n          </td>\n        </tr>\n        <tr class="factorRow">\n          <td data-factorid="').concat(r.data.factors[0].id,'" class="factor cell">\n            <div\n              class="factor-content text-center"\n              contenteditable="true"\n            >\n              ').concat(r.data.factors[0].content,'\n            </div>\n            <span class="factor-btn__del btn-del">Enlever</span>\n          </td>\n          <td class="rate" data-choiceid="').concat(r.data.choices[0].id,'" data-factorid="').concat(r.data.factors[0].id,'">\n          -\n          </td>\n        </tr>\n        <tr>\n          <td class="addCell-factor cell text-center">\n            <div id="addFactor-btn">\n              Ajouter\n            </div>\n          </td>\n          <td></td>\n          <td></td>\n        </tr>\n      </tbody>\n    </table>\n    ')},getFirstRow:function(){return document.querySelector("tr")},getSecondRow:function(){return document.querySelectorAll("tr")[1]},getThirdRow:function(){return document.querySelectorAll("tr")[2]},cloneCell:function(t){return t.cloneNode(!0)},createFactorCell:function(){var t=r.vue.cloneCell(document.querySelector("td.factor[data-factorid='0']"));return t.dataset.factorid=r.data.lastFactorId,t.firstElementChild.innerHTML="Facteur ".concat(r.data.lastFactorId),t},createChoiceCell:function(){var t=r.vue.cloneCell(document.querySelector(".choice.cell[data-choiceid='0']"));return t.dataset.choiceid=r.data.lastChoiceId,t.firstElementChild.innerHTML="Choix ".concat(r.data.lastChoiceId),t},createRateCell:function(){var t=r.vue.cloneCell(document.querySelector("[data-choiceid='0'][data-factorid='0']"));return t.innerHTML="-",t},createScoreCell:function(){var t=r.vue.cloneCell(document.querySelector(".score[data-choiceid='0']"));return t.dataset.choiceid=r.data.lastChoiceId,t.firstElementChild.innerHTML="0",t},createNewRow:function(){var c=r.vue.createNewDOMELement("tr","factorRow");return c.appendChild(r.vue.createFactorCell()),r.data.choices.filter(function(t){return!0===t.visible}).forEach(function(t){var e=r.vue.createRateCell();e.dataset.choiceid=t.id,e.dataset.factorid=r.data.lastFactorId,c.appendChild(e)}),c},insertNewRow:function(){var t=document.querySelector("tbody"),e=document.querySelectorAll("tr");t.insertBefore(r.vue.createNewRow(),e[e.length-1])},insertNewColumn:function(){var t=document.getElementById("lastscorecol"),e=r.vue.getSecondRow().lastElementChild,c=document.getElementsByClassName("factorRow");r.vue.getFirstRow().insertBefore(r.vue.createScoreCell(),t),r.vue.getSecondRow().insertBefore(r.vue.createChoiceCell(),e);for(var a=0;a<c.length;a++){var n=r.data.factors.filter(function(t){return!0===t.visible}),o=r.vue.createRateCell();o.dataset.choiceid=r.data.lastChoiceId,o.dataset.factorid=n[a].id,c[a].appendChild(o)}},deleteRow:function(t){1<document.querySelectorAll("tr.factorRow").length&&t.parentNode.remove()},deleteColumn:function(t){if(1<document.querySelectorAll("td.choice").length)for(var e=document.querySelectorAll("td[data-choiceid='".concat(t,"']")),c=0;c<e.length;c++)e[c].remove()},updateScore:function(t,e){t=document.querySelector(".score[data-choiceid='".concat(t,"']"));t.firstElementChild.innerHTML=e,t.lastElementChild.value=e},incrementRate:function(t){var e=isNaN(t.target.textContent)?0:t.target.textContent;return e<3?e++:e=0,t.target.innerHTML=e},renderBestChoice:function(t){document.getElementById("best-choice").innerText="The best choice is : ".concat(t)},createNewDOMELement:function(t,e,c,a,n){t=0<arguments.length&&void 0!==t?t:"div",e=1<arguments.length?e:void 0,c=2<arguments.length?c:void 0,a=3<arguments.length?a:void 0,n=4<arguments.length?n:void 0,t=document.createElement(t);return void 0!==e&&t.setAttribute("class",e),void 0!==c&&t.setAttribute("id",c),void 0!==a&&(t.dataset.choiceid=a),void 0!==n&&(t.dataset.factorid=n),t}},this.controler.initRender(this.wrapper),this.main()}return _createClass(c,[{key:"main",value:function(){this.controler.listenClickEvents()}},{key:"setContent",value:function(){this.data.choices[i].factors[e.target.parentNode.dataset.factorid].content=e.target.innerHTML.trim()}}]),c}(),myTable=new Table("app");